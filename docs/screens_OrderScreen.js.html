<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: screens/OrderScreen.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: screens/OrderScreen.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import React, { useState, useEffect } from 'react';
import axios from 'axios';
import { PayPalButton } from 'react-paypal-button-v2';
import { Link, useNavigate, useParams } from 'react-router-dom';
import { Row, Col, ListGroup, Image, Card, Button } from 'react-bootstrap';
import { useDispatch, useSelector } from 'react-redux';
import Message from '../components/Message';
import Loader from '../components/Loader';
import {
  getOrderDetails,
  payOrder,
  deliverOrder,
} from '../actions/orderActions';
import {
  ORDER_PAY_RESET,
  ORDER_DELIVER_RESET,
} from '../constants/orderConstants';

/**
 * Renders the OrderScreen component, which displays the details of an order.
 *
 * @param {Object} match - The match object containing the route parameters.
 * @param {Object} history - The history object for navigating between routes.
 * @return {JSX.Element} The rendered OrderScreen component.
 */
const OrderScreen = ({ match, history }) => {
  // const orderId = match.params.id;
  const { orderId } = useParams();

  const [sdkReady, setSdkReady] = useState(false);

  const dispatch = useDispatch();
  const navigate = useNavigate();

  const orderDetails = useSelector((state) => state.orderDetails);
  const { order, loading, error } = orderDetails;

  const orderPay = useSelector((state) => state.orderPay);
  const { loading: loadingPay, success: successPay } = orderPay;

  const orderDeliver = useSelector((state) => state.orderDeliver);
  const { loading: loadingDeliver, success: successDeliver } = orderDeliver;

  const userLogin = useSelector((state) => state.userLogin);
  const { userInfo } = userLogin;

  if (!loading) {
    //   Calculate prices
    const addDecimals = (num) => {
      return (Math.round(num * 100) / 100).toFixed(2);
    };

    order.itemsPrice = addDecimals(
      order.orderItems.reduce((acc, item) => acc + item.price * item.qty, 0)
    );
  }

  useEffect(() => {
    if (!userInfo) {
      //  history.push('/login');
      navigate('/login');
    }

    /**
     * Generates a PayPal script and appends it to the HTML document body.
     *
     * @return {Promise&lt;void>} A promise that resolves when the script has been successfully added.
     */
    const addPayPalScript = async () => {
      const { data: clientId } = await axios.get('/api/config/paypal');
      const script = document.createElement('script');
      script.type = 'text/javascript';
      script.src = `https://www.paypal.com/sdk/js?client-id=${clientId}`;
      script.async = true;
      script.onload = () => {
        setSdkReady(true);
      };
      document.body.appendChild(script);
    };

    if (!order || successPay || successDeliver || order._id !== orderId) {
      dispatch({ type: ORDER_PAY_RESET });
      dispatch({ type: ORDER_DELIVER_RESET });
      dispatch(getOrderDetails(orderId));
    } else if (!order.isPaid) {
      if (!window.paypal) {
        addPayPalScript();
      } else {
        setSdkReady(true);
      }
    }
  }, [dispatch, orderId, successPay, successDeliver, order, navigate]);

  const successPaymentHandler = (paymentResult) => {
    console.log(paymentResult);
    dispatch(payOrder(orderId, paymentResult));
  };

  const deliverHandler = () => {
    dispatch(deliverOrder(order));
  };

  return loading ? (
    &lt;Loader />
  ) : error ? (
    &lt;Message variant="danger">{error}&lt;/Message>
  ) : (
    &lt;>
      &lt;h1>Order {order._id}&lt;/h1>
      &lt;Row>
        &lt;Col md={8}>
          &lt;ListGroup variant="flush">
            &lt;ListGroup.Item>
              &lt;h2>Shipping&lt;/h2>
              &lt;p>
                &lt;strong>Name: &lt;/strong> {order.user.name}
              &lt;/p>
              &lt;p>
                &lt;strong>Email: &lt;/strong>{' '}
                &lt;a href={`mailto:${order.user.email}`}>{order.user.email}&lt;/a>
              &lt;/p>
              &lt;p>
                &lt;strong>Address:&lt;/strong>
                {order.shippingAddress.address}, {order.shippingAddress.city}{' '}
                {order.shippingAddress.postalCode},{' '}
                {order.shippingAddress.country}
              &lt;/p>
              {order.isDelivered ? (
                &lt;Message variant="success">
                  Delivered on {order.deliveredAt}
                &lt;/Message>
              ) : (
                &lt;Message variant="danger">Not Delivered&lt;/Message>
              )}
            &lt;/ListGroup.Item>

            &lt;ListGroup.Item>
              &lt;h2>Payment Method&lt;/h2>
              &lt;p>
                &lt;strong>Method: &lt;/strong>
                {order.paymentMethod}
              &lt;/p>
              {order.isPaid ? (
                &lt;Message variant="success">Paid on {order.paidAt}&lt;/Message>
              ) : (
                &lt;Message variant="danger">Not Paid&lt;/Message>
              )}
            &lt;/ListGroup.Item>

            &lt;ListGroup.Item>
              &lt;h2>Order Items&lt;/h2>
              {order.orderItems.length === 0 ? (
                &lt;Message>Order is empty&lt;/Message>
              ) : (
                &lt;ListGroup variant="flush">
                  {order.orderItems.map((item, index) => (
                    &lt;ListGroup.Item key={index}>
                      &lt;Row>
                        &lt;Col md={1}>
                          &lt;Image
                            src={item.image}
                            alt={item.name}
                            fluid
                            rounded
                          />
                        &lt;/Col>
                        &lt;Col>
                          &lt;Link to={`/product/${item.product}`}>
                            {item.name}
                          &lt;/Link>
                        &lt;/Col>
                        &lt;Col md={4}>
                          {item.qty} x ${item.price} = ${item.qty * item.price}
                        &lt;/Col>
                      &lt;/Row>
                    &lt;/ListGroup.Item>
                  ))}
                &lt;/ListGroup>
              )}
            &lt;/ListGroup.Item>
          &lt;/ListGroup>
        &lt;/Col>
        &lt;Col md={4}>
          &lt;Card>
            &lt;ListGroup variant="flush">
              &lt;ListGroup.Item>
                &lt;h2>Order Summary&lt;/h2>
              &lt;/ListGroup.Item>
              &lt;ListGroup.Item>
                &lt;Row>
                  &lt;Col>Items&lt;/Col>
                  &lt;Col>${order.itemsPrice}&lt;/Col>
                &lt;/Row>
              &lt;/ListGroup.Item>
              &lt;ListGroup.Item>
                &lt;Row>
                  &lt;Col>Shipping&lt;/Col>
                  &lt;Col>${order.shippingPrice}&lt;/Col>
                &lt;/Row>
              &lt;/ListGroup.Item>
              &lt;ListGroup.Item>
                &lt;Row>
                  &lt;Col>Tax&lt;/Col>
                  &lt;Col>${order.taxPrice}&lt;/Col>
                &lt;/Row>
              &lt;/ListGroup.Item>
              &lt;ListGroup.Item>
                &lt;Row>
                  &lt;Col>Total&lt;/Col>
                  &lt;Col>${order.totalPrice}&lt;/Col>
                &lt;/Row>
              &lt;/ListGroup.Item>
              {!order.isPaid &amp;&amp; (
                &lt;ListGroup.Item>
                  {loadingPay &amp;&amp; &lt;Loader />}
                  {!sdkReady ? (
                    &lt;Loader />
                  ) : (
                    &lt;PayPalButton
                      amount={order.totalPrice}
                      onSuccess={successPaymentHandler}
                    />
                  )}
                &lt;/ListGroup.Item>
              )}
              {loadingDeliver &amp;&amp; &lt;Loader />}
              {userInfo &amp;&amp;
                userInfo.isAdmin &amp;&amp;
                order.isPaid &amp;&amp;
                !order.isDelivered &amp;&amp; (
                  &lt;ListGroup.Item>
                    &lt;Button
                      type="button"
                      className="btn btn-block"
                      onClick={deliverHandler}
                    >
                      Mark As Delivered
                    &lt;/Button>
                  &lt;/ListGroup.Item>
                )}
            &lt;/ListGroup>
          &lt;/Card>
        &lt;/Col>
      &lt;/Row>
    &lt;/>
  );
};

export default OrderScreen;
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Global</h3><ul><li><a href="global.html#App">App</a></li><li><a href="global.html#CartScreen">CartScreen</a></li><li><a href="global.html#CheckoutSteps">CheckoutSteps</a></li><li><a href="global.html#Footer">Footer</a></li><li><a href="global.html#FormContainer">FormContainer</a></li><li><a href="global.html#Header">Header</a></li><li><a href="global.html#HomeScreen">HomeScreen</a></li><li><a href="global.html#Loader">Loader</a></li><li><a href="global.html#LoginScreen">LoginScreen</a></li><li><a href="global.html#Message">Message</a></li><li><a href="global.html#Meta">Meta</a></li><li><a href="global.html#OrderListScreen">OrderListScreen</a></li><li><a href="global.html#OrderScreen">OrderScreen</a></li><li><a href="global.html#Paginate">Paginate</a></li><li><a href="global.html#PaymentScreen">PaymentScreen</a></li><li><a href="global.html#PlaceOrderScreen">PlaceOrderScreen</a></li><li><a href="global.html#Product">Product</a></li><li><a href="global.html#ProductCarousel">ProductCarousel</a></li><li><a href="global.html#ProductEditScreen">ProductEditScreen</a></li><li><a href="global.html#ProductListScreen">ProductListScreen</a></li><li><a href="global.html#ProductScreen">ProductScreen</a></li><li><a href="global.html#ProfileScreen">ProfileScreen</a></li><li><a href="global.html#Rating">Rating</a></li><li><a href="global.html#RegisterScreen">RegisterScreen</a></li><li><a href="global.html#SearchBox">SearchBox</a></li><li><a href="global.html#ShippingScreen">ShippingScreen</a></li><li><a href="global.html#UserEditScreen">UserEditScreen</a></li><li><a href="global.html#UserListScreen">UserListScreen</a></li><li><a href="global.html#addToCart">addToCart</a></li><li><a href="global.html#cartReducer">cartReducer</a></li><li><a href="global.html#createOrder">createOrder</a></li><li><a href="global.html#createProduct">createProduct</a></li><li><a href="global.html#createProductReview">createProductReview</a></li><li><a href="global.html#deleteProduct">deleteProduct</a></li><li><a href="global.html#deleteUser">deleteUser</a></li><li><a href="global.html#deliverOrder">deliverOrder</a></li><li><a href="global.html#getOrderDetails">getOrderDetails</a></li><li><a href="global.html#getUserDetails">getUserDetails</a></li><li><a href="global.html#listMyOrders">listMyOrders</a></li><li><a href="global.html#listOrders">listOrders</a></li><li><a href="global.html#listProductDetails">listProductDetails</a></li><li><a href="global.html#listProducts">listProducts</a></li><li><a href="global.html#listTopProducts">listTopProducts</a></li><li><a href="global.html#listUsers">listUsers</a></li><li><a href="global.html#login">login</a></li><li><a href="global.html#logout">logout</a></li><li><a href="global.html#orderCreateReducer">orderCreateReducer</a></li><li><a href="global.html#orderDeliverReducer">orderDeliverReducer</a></li><li><a href="global.html#orderDetailsReducer">orderDetailsReducer</a></li><li><a href="global.html#orderListMyReducer">orderListMyReducer</a></li><li><a href="global.html#orderListReducer">orderListReducer</a></li><li><a href="global.html#orderPayReducer">orderPayReducer</a></li><li><a href="global.html#payOrder">payOrder</a></li><li><a href="global.html#productCreateReducer">productCreateReducer</a></li><li><a href="global.html#productDeleteReducer">productDeleteReducer</a></li><li><a href="global.html#productDetailsReducer">productDetailsReducer</a></li><li><a href="global.html#productListReducer">productListReducer</a></li><li><a href="global.html#productReviewCreateReducer">productReviewCreateReducer</a></li><li><a href="global.html#productTopRatedReducer">productTopRatedReducer</a></li><li><a href="global.html#productUpdateReducer">productUpdateReducer</a></li><li><a href="global.html#register">register</a></li><li><a href="global.html#removeFromCart">removeFromCart</a></li><li><a href="global.html#savePaymentMethod">savePaymentMethod</a></li><li><a href="global.html#saveShippingAddress">saveShippingAddress</a></li><li><a href="global.html#updateProduct">updateProduct</a></li><li><a href="global.html#updateUser">updateUser</a></li><li><a href="global.html#updateUserProfile">updateUserProfile</a></li><li><a href="global.html#userDeleteReducer">userDeleteReducer</a></li><li><a href="global.html#userDetailsReducer">userDetailsReducer</a></li><li><a href="global.html#userListReducer">userListReducer</a></li><li><a href="global.html#userLoginReducer">userLoginReducer</a></li><li><a href="global.html#userRegisterReducer">userRegisterReducer</a></li><li><a href="global.html#userUpdateProfileReducer">userUpdateProfileReducer</a></li><li><a href="global.html#userUpdateReducer">userUpdateReducer</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 4.0.2</a> on Sun Oct 22 2023 18:12:27 GMT+0200 (heure d’été d’Europe centrale)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
